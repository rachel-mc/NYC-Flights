---
title: "NYC Flights - Supplementary Information"
author: "Ellen Creed, Rachel McInerney, Siun Mulcahy, Conor Thompson"
date: "`r format(Sys.time(), '%X %d %B, %Y')`"
output:
  html_document:
    code_folding: hide
---

```{r}
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
```


## Exploratory Data Analysis

```{r}
# Uncomment to produce an autogenerated data summary from dataReporter on your device
# install.packages("dataReporter")
# dataReporter::makeDataReport(flights, replace = TRUE)

flights <- nycflights13::flights[complete.cases(nycflights13::flights[,]),] 

# Initial view of data obtained using glimpse and str functions
head(nycflights13::airports)
```

## Additional Tables 

### Question 1

```{r}
average_delay <- flights |>
  group_by(carrier) |>
  summarise(avg_arrival_delay = mean(arr_delay))

# Each airline arranged by average arrival delay in ascending order
average_delay_airline <- average_delay[order(average_delay$avg_arrival_delay), ]
average_delay_airline

# Most delayed flight in the dataset
flights |> slice_max(arr_delay)

# Time variables in the dataset
flights |> select(contains('time'))

# Could also explore the time made up
flights1 <- flights |> mutate(gain = arr_delay - dep_delay, 
                  gain_per_hour = gain / (air_time / 60)) |>
  select(arr_delay, dep_delay, gain, gain_per_hour) 
```


### Question 2

```{r}
air_num <- flights |>
  group_by(tailnum) |>
  summarise(airtime = median(air_time))

# Sort in decreasing order
air_num |> arrange(desc(airtime))
planes <- nycflights13::planes # # all plane tailnumbers found of the FAA aircraft registry
planes |> filter(tailnum == "N384HA")
```


## More Visualisations

```{r}
# Correlation between Arrival and Departure delays
flights |>
  ggplot(aes(x = dep_delay, y = arr_delay, color = carrier)) +
  geom_point() +
  labs(x = "Departure Delay (minutes)", y = "Arrival Delay (minutes)",
       title = "Scatterplot of Arrival Delay vs. Departure Delay",
       color = "Airline") +
  theme_minimal()
# Expected linear relationship with some noise/variation
```

```{r}
# Scatter plot of mean Distance vs Scheduled Departure Time per plane with
# superimposed Generalised Additive Model
data1 <- flights |>
  group_by(tailnum) |>
  summarise(count = n(), 
            dist = mean(distance), 
            dep = mean(sched_dep_time))

ggplot(data1, aes(dist, dep)) +
  geom_point(aes(size = count), alpha = 0.25) +
  geom_smooth() +
  scale_size_area() +
  theme_bw()
```

